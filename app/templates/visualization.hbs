
<div class="layout-row layout-sm-column">
  {{#paper-card class="flex term-ontology-card" as |card|}}
    {{#card.content class="layout-row layout-align-space-between flex-100 term-ontology-graph-container"}}
      {{#unless (eq percenttermsloaded 100)}}
        <div class="layout-row flex layout-align-center-center">

          {{#if (gte percenttermsloaded 2)}}
            <div class="loading-text">Loading terms...</div>
            {{paper-progress-circular warn=true value=percenttermsloaded diameter=180}}
          {{else}}
            <div class="loading-text">Fetching Data...</div>
            {{paper-progress-circular warn=true diameter=180}}
          {{/if}}
        </div>
      {{else}}
        {{term-ontology nodes=model links=links parentNodes=parentNodes showTermLabels=showTermLabels linkForcesOn=linkForcesOn renderEventQueue=renderEventQueue}}
      {{/unless}}
    {{/card.content}}
  {{/paper-card}}

  <div class="layout-column flex-gt-sm-50 flex-gt-md-40 flex-gt-lg-30 termlist">
    {{#paper-card}}
      {{#paper-toolbar accent=true}}
        {{#paper-toolbar-tools}}
          <h5>
            Exploring {{route.termstoload}} terms<br>
            Total Terms in Ontology: {{route.termcount}}
          </h5>
        {{/paper-toolbar-tools}}
      {{/paper-toolbar}}
      {{#paper-list}}
        {{#paper-subheader}}Graph options{{/paper-subheader}}
          <div class="layout layout-align-center-center slider-container graph-options-slider">
            <span style="margin-right: 16px;">Number of Clusters</span>
            {{paper-slider class="flex" dragging=clusterdragging min=1 max=route.termstoload value=route.clusters onChange=(action (mut route.clusters))}}
            {{paper-input value=route.clusters onChange=(action (mut route.clusters))}}
          </div>
        {{#paper-item as |controls|}}
          <p>Show Term Labels?</p>
          <div class="md-secondary-container">
            {{controls.checkbox
              value=showTermLabels
              secondary=true
              onChange=(action (mut showTermLabels))}}
          </div>
        {{/paper-item}}
        {{#paper-item as |controls|}}
          <p>Apply forces on links?</p>
          <div class="md-secondary-container">
            {{controls.checkbox
              value=linkForce
              secondary=true
              onChange=(action (mut linkForce))}}
          </div>
        {{/paper-item}}
      {{/paper-list}}
      {{#paper-list class="scrollabletermlist"}}
        {{#paper-subheader}}Terms{{/paper-subheader}}
          {{#each sortedNodeClusters as |cluster|}}
            {{#paper-expansion-panel as |panel|}}
              {{#panel.collapsed}}
                <div class="md-panel-title">Cluster {{cluster.name}}</div>
                <div class="md-panel-summary">{{cluster.nodes.length}} Terms / {{cluster.genes.length}} Genes</div>
                {{paper-icon "keyboard_arrow_down"}}
              {{/panel.collapsed}}

              {{#panel.expanded as |expanded|}}
                {{#expanded.header}}
                  <div class="md-panel-title">Cluster {{cluster.name}}</div>
                  <div class="md-panel-summary">{{cluster.nodes.length}} Terms / {{cluster.genes.length}} Genes</div>
                  {{paper-icon "keyboard_arrow_up"}}
                {{/expanded.header}}

                {{#expanded.content}}

                  <!-- term sub Panel -->
                  {{#paper-expansion-panel as |termpanel|}}
                    {{#termpanel.collapsed}}
                      <div class="md-panel-summary"> Terms </div>
                      {{paper-icon "keyboard_arrow_down"}}
                    {{/termpanel.collapsed}}
                    {{#termpanel.expanded as |termsexpanded|}}
                      {{#termsexpanded.header}}
                        <div class="md-panel-summary"> Terms </div>
                        {{paper-icon "keyboard_arrow_down"}}
                      {{/termsexpanded.header}}
                      {{#termsexpanded.content}}
                        {{#each cluster.nodes as |node|}}
                          {{#paper-item class="md-3-line" onClick=(action "toggleSelectedTerm" node) as |controls|}}
                            {{paper-icon "title" class=(concat "md-avatar-icon" (if node.enrichment.selected " term-selected"))}}
                            <div class="md-list-item-text">
                              <h3>
                                <strong>{{node.term.termid}} [p={{node.enrichment.pvalue}},l={{node.enrichment.level}}]</strong>
                              </h3>
                              <h4>{{node.term.name}}</h4>
                              <p>
                                {{node.term.description}}
                              </p>
                            </div>
                          {{/paper-item}}
                        {{/each}}
                      {{/termsexpanded.content}}
                    {{/termpanel.expanded}}
                  {{/paper-expansion-panel}}
                    <!-- Gene sub Panel -->
                  {{#paper-expansion-panel as |genepanel|}}
                    {{#genepanel.collapsed}}
                      <div class="md-panel-summary"> Genes </div>
                      {{paper-icon "keyboard_arrow_down"}}
                    {{/genepanel.collapsed}}

                    {{#genepanel.expanded as |genesexpanded|}}
                      {{#genesexpanded.header}}
                        <div class="md-panel-summary"> Genes </div>
                        {{paper-icon "keyboard_arrow_down"}}
                      {{/genesexpanded.header}}
                      {{#genesexpanded.content}}
                        {{#each cluster.genes as |gene|}}
                          {{#paper-item class="md-2-line" onClick=(action "toggleSelectedTerm" node) as |controls|}}
                            <div class="md-list-item-text">
                              <p>
                                <strong>{{gene.geneid}}</strong>
                              </p>
                            </div>
                          {{/paper-item}}
                        {{/each}}
                      {{/genesexpanded.content}}
                    {{/genepanel.expanded}}
                  {{/paper-expansion-panel}}

                {{/expanded.content}}

                {{!-- {{#expanded.footer}}
                {{/expanded.footer}} --}}

              {{/panel.expanded}}
            {{/paper-expansion-panel}}


          {{/each}}

      {{/paper-list}}
    {{/paper-card}}
  </div>
</div>
